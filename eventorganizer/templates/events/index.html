{% extends 'homepage/layout.html' %}
{% load static %}
{% block title %} Events List {% endblock %}
{% block content %}
<div class="container">
    <h1 class="my-4">Events List</h1>

    <h1 class="my-4">Event List</h1>
    <a href="{% url 'create_events' %}" class="btn btn-info px-3 mt-1 fs-5 fw-bold ">Add Events</a><p> </p>
    <form method="GET" action="{% url 'read_events' %}" class="d-flex mb-3">
        <input class="form-control me-2" type="search" name="q" placeholder="Search Events..." 
               value="{{ query|default:'' }}" aria-label="Search">
        <button class="btn btn-info px-3 py-30 mt-1 fs-5 fw-bold" type="submit">Search</button>
    </form>
    <table class="table table-striped table-bordered">
        <thead class="thead-dark">
            <tr>
                <th>Title</th>
                <th>Description</th>
                <th>Category</th>
                <th>Theme</th>
                <th>Organizer</th>
                <th>Image</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for event in events %}
            <tr>

                <td>{{ event.title }}</td>
                <td>{{ event.description }}</td>
                <td>{{ event.category }}</td>
                <td>{{ event.theme }}</td>
                <td>{{ event.organizer.name}} - {{ event.organizer.location}} </td>
                <td><img src="{{ event.image.url }}" alt="{{ event.title }}" style="max-width:300px;"/></td>
                <td>

                    <a href="{% url 'update_events' event.id %}" class="btn btn-sm btn-info"> 
                        <img src="{% static 'images/edit.png' %}" alt="Delete" style="width: 20px; height: 20px;">
                    </a>
                    <p></p>
                    <button class="btn btn-sm btn-info" onclick="confirmDelete('{{event.id }}')">
                        <img src="{% static 'images/delete.png' %}" alt="Edit" style="width: 20px; height: 20px;">
                    </button>

                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center">There is no events exist. </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
function confirmDelete(eventId) {
    Swal.fire({
        title: 'Delete the events?',
        text: 'Data cannot be restored!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes'
    }).then((result) => {
        if (result.isConfirmed) {
            // AJAX request
            fetch(`/event/delete/${eventId}`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            }).then(response => {
                if (response.ok) {
                    Swal.fire(
                        'Deleted!',
                        'Event has been deleted.',
                        'success'
                    ).then(() => {
                        // Reload the page after success
                        window.location.reload();
                    });
                } else {
                    Swal.fire(
                        'Error!',
                        'There was an issue deleting the student.',
                        'error'
                    );
                }
            });
        }
    });
}
</script>

</div>
{% endblock %}
